syntax = "proto3";

package shardorchestrator;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/smartcontractkit/chainlink-common/pkg/workflows/shardorchestrator/pb";

message GetWorkflowShardMappingRequest {
  repeated string workflow_ids = 1;
}

message WorkflowMappingState {
  uint32 old_shard_id = 1;
  uint32 new_shard_id = 2;
  bool in_transition = 3;
  google.protobuf.Timestamp last_updated = 4;
}

message GetWorkflowShardMappingResponse {
  map<string, uint32> mappings = 1;
  map<string, WorkflowMappingState> mapping_states = 2;
  google.protobuf.Timestamp timestamp = 3;
  uint64 mapping_version = 4;
}

message ReportWorkflowTriggerRegistrationRequest {
  uint32 source_shard_id = 1;
  map<string, uint32> registered_workflows = 2;
  google.protobuf.Timestamp report_timestamp = 3;
  uint32 total_active_workflows = 4;
}

message ReportWorkflowTriggerRegistrationResponse {
  bool success = 1;
}

service ShardOrchestratorService {
  rpc GetWorkflowShardMapping(GetWorkflowShardMappingRequest) returns (GetWorkflowShardMappingResponse); // returns shard assignments for the specified workflows
  rpc ReportWorkflowTriggerRegistration(ReportWorkflowTriggerRegistrationRequest) returns (ReportWorkflowTriggerRegistrationResponse); // called by shards to report their workflow trigger registrations
}
