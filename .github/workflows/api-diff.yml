name: Analyze API Changes
on:
  pull_request:

jobs:
  analyze:
    permissions:
      pull-requests: write
      contents: read
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Go
        uses: ./.github/actions/setup-go
        with:
          go-version-file: "go.mod"
          only-modules: "true"

      - name: Find branch point
        id: find-base-sha
        env:
          BASE_REF: ${{ github.event.pull_request.base.ref }}
          HEAD_REF: ${{ github.event.pull_request.head.ref }}
        run: |-
          BASE_SHA=$(git merge-base "$BASE_REF" "$HEAD_REF")
          echo "base-sha=$BASE_SHA" | tee -a "$GITHUB_OUTPUT"

      - uses: smartcontractkit/.github/actions/apidiff-go@feat/goalng-apidiff-action # todo
        env:
          GITHUB_TOKEN: ${{ github.token }}
        with:
          base-ref: ${{ steps.find-base-sha.outputs.base-sha }}

  # analyze-apidiff:
  #   permissions:
  #     pull-requests: write
  #     contents: read
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout the repository
  #       uses: actions/checkout@v4
  #       with:
  #         fetch-depth: 0

  #     - name: Set up Go
  #       uses: ./.github/actions/setup-go
  #       with:
  #         go-version-file: "go.mod"
  #         only-modules: "true"

  #     - name: Run script/apidiff.sh
  #       run: |
  #         go install golang.org/x/exp/cmd/apidiff@latest
  #         ./script/apidiff.sh
